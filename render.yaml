services:
  - type: web
    name: devinswarm-service
    runtime: node
    plan: starter
    buildCommand: "npm ci && npm run db:generate && npm run db:push && npm run build"
    startCommand: "npm run start:service"
    envVars:
      - key: NODE_VERSION
        value: "20.19.0"
      - key: OPENAI_API_KEY
        sync: false
      - key: REDIS_URL
        fromService:
          type: keyvalue
          name: devinswarm-kv
          property: connectionString
      - key: DATABASE_URL
        fromDatabase:
          name: devinswarm-postgres
          property: connectionString
      - key: GITHUB_APP_ID
        sync: false
      - key: GITHUB_INSTALLATION_ID
        sync: false
      - key: GITHUB_PRIVATE_KEY
        sync: false
      - key: GITHUB_WEBHOOK_SECRET
        sync: false
      - key: DAILY_BUDGET_USD
        value: "75"
      - key: AUTO_MERGE_LOW_RISK
        value: "true"
      - key: ALLOWED_REPOS
        value: "DevinBristol/DevinSwarm"
      - key: ARTIFACT_BLOB_THRESHOLD_BYTES
        value: "5000000"
      - key: ARTIFACT_RETENTION_DAYS
        value: "7"
      - key: UI_TOKEN
        sync: false
    healthCheckPath: "/health"

  - type: worker
    name: devinswarm-worker
    runtime: node
    plan: starter
    buildCommand: "npm ci && npm run db:generate && npm run db:push && npm run build"
    startCommand: "npm run start:worker"
    envVars:
      - key: NODE_VERSION
        value: "20.19.0"
      - key: OPENAI_API_KEY
        sync: false
      - key: REDIS_URL
        fromService:
          type: keyvalue
          name: devinswarm-kv
          property: connectionString
      - key: DATABASE_URL
        fromDatabase:
          name: devinswarm-postgres
          property: connectionString
      - key: GITHUB_APP_ID
        sync: false
      - key: GITHUB_INSTALLATION_ID
        sync: false
      - key: GITHUB_PRIVATE_KEY
        sync: false
      - key: GITHUB_WEBHOOK_SECRET
        sync: false
      - key: DAILY_BUDGET_USD
        value: "75"
      - key: AUTO_MERGE_LOW_RISK
        value: "true"
      - key: ALLOWED_REPOS
        value: "DevinBristol/DevinSwarm"
      - key: ARTIFACT_BLOB_THRESHOLD_BYTES
        value: "5000000"
      - key: ARTIFACT_RETENTION_DAYS
        value: "7"
      - key: UI_TOKEN
        sync: false

  - type: worker
    name: devinswarm-reviewer
    runtime: node
    plan: starter
    buildCommand: "npm ci && npm run db:generate && npm run db:push && npm run build"
    startCommand: "npm run start:reviewer-worker"
    envVars:
      - key: NODE_VERSION
        value: "20.19.0"
      - key: OPENAI_API_KEY
        sync: false
      - key: REDIS_URL
        fromService:
          type: keyvalue
          name: devinswarm-kv
          property: connectionString
      - key: DATABASE_URL
        fromDatabase:
          name: devinswarm-postgres
          property: connectionString
      - key: GITHUB_APP_ID
        sync: false
      - key: GITHUB_INSTALLATION_ID
        sync: false
      - key: GITHUB_PRIVATE_KEY
        sync: false
      - key: GITHUB_WEBHOOK_SECRET
        sync: false
      - key: DAILY_BUDGET_USD
        value: "75"
      - key: AUTO_MERGE_LOW_RISK
        value: "true"
      - key: ALLOWED_REPOS
        value: "DevinBristol/DevinSwarm"
      - key: ARTIFACT_BLOB_THRESHOLD_BYTES
        value: "5000000"
      - key: ARTIFACT_RETENTION_DAYS
        value: "7"
      - key: UI_TOKEN
        sync: false

  - type: worker
    name: devinswarm-ops
    runtime: node
    plan: starter
    buildCommand: "npm ci && npm run db:generate && npm run db:push && npm run build"
    startCommand: "npm run start:ops-worker"
    envVars:
      - key: NODE_VERSION
        value: "20.19.0"
      - key: OPENAI_API_KEY
        sync: false
      - key: REDIS_URL
        fromService:
          type: keyvalue
          name: devinswarm-kv
          property: connectionString
      - key: DATABASE_URL
        fromDatabase:
          name: devinswarm-postgres
          property: connectionString
      - key: GITHUB_APP_ID
        sync: false
      - key: GITHUB_INSTALLATION_ID
        sync: false
      - key: GITHUB_PRIVATE_KEY
        sync: false
      - key: GITHUB_WEBHOOK_SECRET
        sync: false
      - key: DAILY_BUDGET_USD
        value: "75"
      - key: AUTO_MERGE_LOW_RISK
        value: "true"
      - key: ALLOWED_REPOS
        value: "DevinBristol/DevinSwarm"
      - key: ARTIFACT_BLOB_THRESHOLD_BYTES
        value: "5000000"
      - key: ARTIFACT_RETENTION_DAYS
        value: "7"
      - key: UI_TOKEN
        sync: false

  - type: keyvalue
    name: devinswarm-kv
    plan: starter
    ipAllowList: []

databases:
  - name: devinswarm-postgres

